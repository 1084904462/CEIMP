<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>查看奖学金</title>
    <link th:href="@{/static/vendor/bootstrap/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/static/vendor/metisMenu/metisMenu.min.css}" rel="stylesheet"/>
    <link th:href="@{/static/vendor/datatables-plugins/dataTables.bootstrap.css}" rel="stylesheet"/>
    <link th:href="@{/static/vendor/datatables-responsive/dataTables.responsive.css}" rel="stylesheet"/>
    <link th:href="@{/static/dist/css/sb-admin-2.css}" rel="stylesheet"/>
    <link th:href="@{/static/vendor/font-awesome/css/font-awesome.min.css}" rel="stylesheet" type="text/css"/>
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link th:href="@{/static/css/manager/showScholarship.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{/static/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/static/vendor/bootstrap/js/bootstrap.min.js}"></script>
    <script th:src="@{/static/vendor/metisMenu/metisMenu.min.js}"></script>
    <script th:src="@{/static/vendor/datatables/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{/static/vendor/datatables-plugins/dataTables.bootstrap.min.js}"></script>
    <script th:src="@{/static/vendor/datatables-responsive/dataTables.responsive.js}"></script>
    <script th:src="@{/static/dist/js/sb-admin-2.js}"></script>
<!--
    <script th:src="@{/static/js/manager/showScholarship.js}"></script>
-->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>-->
</head>
<body>

    <div id="wrapper">


        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-brand" >综合测评管理系统管理员端</div>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                
              
              
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                        <font style="margin-left: 15px;margin-right: 30px;" th:text="${session.managerLogBean.account}" ></font>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                       
                        <li><a href="javascript:void(0)"><i class="fa fa-gear fa-fw"></i> 修改密码</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="/managerLogout"><i class="fa fa-sign-out fa-fw"></i> 退出登录</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="/manager/index"><i class="fa fa-dashboard fa-fw"></i> 概览</a>
                        </li>
                       
                        <li>
                            <a href="javascript:void(0)">
                            	<i class="fa fa-table fa-fw"></i>  
                            查看名单
                            	<span class="fa arrow"></span>
                            </a>
                            <ul class="nav nav-second-level">
                                <li onclick=""><a href="/manager/scholarship/ng"><span class="text">国家助学金</span></a>
                                </li>
                                <li onclick=""><a href="/manager/scholarship/nis"><span class="text ">国家励志奖学金</span></a>
                                </li>
                                <li onclick=""><a href="/manager/scholarship/pgs"><span class="text">省政府奖学金</span></a>
                                </li>
                                <li onclick=""><a href="/manager/scholarship/ss"><span class="text">校奖学金</span></a>
                                </li>
                                <li onclick=""><a href="/manager/scholarship/tas"><span class="text">三好学生</span></a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0)"><i class="fa fa-edit fa-fw"></i> 填写意见<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                               
                               <li onclick=""><a href="/manager/scholarship/opinion"><span class="text ">奖学金意见填写</span></a>
                                </li>
                                 <li onclick=""><a href="/manager/scholarship/opinion/ng"><span class="text">国家助学金审批意见</span></a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="/manager/settings/resetPassword"><i class="fa fa-wrench fa-fw"></i> 重置学生密码</a>
                            
                            <!-- /.nav-second-level -->
                        </li>
                       
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    
                    <h1 class="page-header" th:text="${showScholarshipBean.scholarshipName}"></h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading" style="padding: 0px;margin: 0px;">
                            <ul class="nav nav-tabs" >
                                <li role="presentation" class="active" id="b1"  onclick="fire_ajax_update(event)"><a href="javascript:void(0)" >2016级</a></li>
                                <li role="presentation" id="b2" onclick="fire_ajax_update2(event)"><a href="javascript:void(0)"  >2015级</a></li> <!--style="color: grey"-->
                                <!--<li role="presentation" ><a href="javascript:void(0)" >Messages</a></li>&lt;!&ndash;style="color: grey"&ndash;&gt;-->
                            </ul>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">








                            <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example" >
                                <thead>
                                <tr>
                                    <th>

                                        <input type="checkbox" id="checkAll" name=""/>

                                    </th>
                                    <th >专业

                                    </th>
                                    <th>班级号</th>
                                    <th >学号</th>

                                    <th>姓名</th>
                                    <th>获奖名称</th>
                                    <th class="setWidth">操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                <tr th:each="person : ${scholarshipFormBeanList}" >
                                    <th scope="row">
                                        <input type="checkbox" id="blankCheckbox1" value="option1" name="subBox" aria-label="..." style="margin-top:7px;"/>
                                    </th>
                                    <td th:text="${person.major}"></td>
                                    <td th:text="${person.classNum}"></td>
                                    <td th:text="${person.account}" class="account"></td>
                                    <td th:text="${person.username}"></td>
                                    <td th:text="${person.scholarshipName}"></td>



                                    <th style="text-align: center;">
                                        <button type="button" class="btn btn-info btn-sm radius downloadScholarshipButton" onclick="fire_ajax_download(event)"  >下载</button>
                                        <button type="button" class="btn btn-danger2 btn-sm interval radius" style="margin-left: 30px;"  onclick="fire_ajax_delete(event)"  data-toggle="modal" data-target="#deleteScholarship">删除</button>
                                    </th>
                                </tr>

                                </tbody>
                            </table>
                            <!-- /.table-responsive -->
                             <span class="panel-body_number">已选 <span id="checkedNumber15">0</span> 人</span>
                            <span class="panel-body_number"> <button type="button" class="btn btn-default btn-sm radius downloadScholarshipButton" id="batchDownload"  >批量下载</button> </span>
                        </div>
                        
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
           
        </div>
        <!-- /#page-wrapper -->








    </div>


    <!--删除Modal -->
    <div class="modal fade" id="deleteScholarship" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">删除操作</h4>
                </div>
                <div class="modal-body" id="deleteScholarship-content">
                    确认删除？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary"  id="deleteScholarshipButton"  data-dismiss="modal">删除</button>
                </div>
            </div>
        </div>
    </div>

    <!--打包Modal -->
    <div class="modal fade" id="downloadScholarship" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" >下载操作</h4>
                </div>
                <div class="modal-body" id="downloadScholarship-content">
                    确认下载？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary"   data-dismiss="modal">下载</button>
                </div>
            </div>
        </div>
    </div>
    <!--全部打包Modal -->
    <div class="modal fade" id="batchDownloadScholarship" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" >下载操作</h4>
                </div>
                <div class="modal-body" id="batchDownloadScholarship-content">
                    确认全部下载？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary"  id="batchDownloadScholarshipButton"  data-dismiss="modal">下载</button>
                </div>
            </div>
        </div>
    </div>




</body>
<script>


</script>
<script th:inline="javascript">
    $(document).ready(function() {

        var oTable=$('#dataTables-example').DataTable({
            responsive: true,
            "order": [[ 1, "desc" ]],
            "columnDefs": [{ "targets": [0, 6], "orderable": false }]

        });
        var allPages = oTable.cells( ).nodes( );

        $('#checkAll').click(function () {
            if ($(this).hasClass('allChecked')) {
                $(allPages).find('input[name="subBox"]').prop('checked', false);
                $("#checkedNumber15").text( $(allPages).find('input[name="subBox"]:checked').length);
            } else {
                $(allPages).find('input[name="subBox"]').prop('checked', true);
                $("#checkedNumber15").text( $(allPages).find('input[name="subBox"]:checked').length);
            }
            $(this).toggleClass('allChecked');
        });






        /*$("#checkAll2").click(function() {
            if ($(this).hasClass('checked')) {
                $('input[name="subBox"]').prop("checked",false);
                $("#checkedNumber15").text( $(allPages).find('input[name="subBox"]:checked').length);}
            else {
                $('input[name="subBox"]').prop("checked",true);
                $("#checkedNumber15").text( $(allPages).find('input[name="subBox"]:checked').length);}
            $(this).toggleClass('checked');
        });*/
        var $subBox = $(allPages).find('input[name="subBox"]');
        $subBox.click(function(){
            /!*  $("#checkAll2").prop("checked",$subBox.length == $("input[name='subBox']:checked").length ? true : false);*!/
            $("#checkedNumber15").text($(allPages).find('input[name="subBox"]:checked').length);

        });

        $("#batchDownload").click(function () {
            var checked=$(allPages).find('input[name="subBox"]:checked');
            var zipInfoBeanList=new Array();
            let iterable = new Array(checked.length);
            var i=0;
            var zipInfoBean;

            for (let value of iterable) {

                zipInfoBean={account:$($($(checked[i]).parent()).parent()).children()[3].innerHTML,username:$($($(checked[i]).parent()).parent()).children()[4].innerHTML,scholarshipName:$($($(checked[i]).parent()).parent()).children()[5].innerHTML};
                zipInfoBeanList.push(zipInfoBean);
                i++;
            }

            var account1=[[${showScholarshipBean}]];
            var showScholarshipBean=[[${showScholarshipBean}]];



            var tempform = document.createElement("form");
            tempform.action = "/manager/scholarship/zip/"+showScholarshipBean.subName+"/"+showScholarshipBean.yearScope;
            tempform.method = "post";
            tempform.style.display="none"
            tempform.target="_blank";


            /* for (var x in ZipInfoBean) {
                 var opt = document.createElement("input");
                 opt.name = x;
                 opt.value = ZipInfoBean[x];
                 tempform.appendChild(opt);
             }
 */
            var opt2=document.createElement("input");
            opt2.name="zipInfoBeanList";
            opt2.value=JSON.stringify(zipInfoBeanList);
            var opt = document.createElement("input");
            opt.type = "submit";
            tempform.appendChild(opt2);
            tempform.appendChild(opt);
            document.body.appendChild(tempform);
            tempform.submit();
            document.body.removeChild(tempform);




        });

    });

    function fire_ajax_update(event) {
        var showScholarshipBean=[[${showScholarshipBean}]];
        /*$("#b1").className="";
        $("#b2").className="active";*/
        console.log();
        $("#b2").attr("class","");
        $("#b1").attr("class","active");





        $.ajax({
            type: "get",
            contentType: "application/json",
            url: "/manager/scholarship/"+showScholarshipBean.subName+"/"+showScholarshipBean.grade[0],//
            dataType: 'json',
            cache: false,
            timeout: 600000,

            success: function (data) {
                let iterable = new Array(data.length);
                $(".table tbody").html("");

                var i=0;


                for (let value of iterable) {
                    var input=document.createElement("input");
                    input.setAttribute("type","checkbox");
                    input.setAttribute("name","subBox");
                    input.setAttribute("style","margin-top:7px;");



                    var button=document.createElement("button");
                    button.innerHTML = "下载";
                    button.className="btn btn-info btn-sm radius downloadScholarshipButton";
                    button.setAttribute("onclick","fire_ajax_download(event)");


                    var button2=document.createElement("button");
                    button2.innerHTML = "删除";
                    button2.className="btn btn-danger2 btn-sm interval radius";
                    button2.setAttribute("style","margin-left:30px;");
                    button2.setAttribute("onclick","fire_ajax_delete(event)");
                    button2.setAttribute("data-toggle","modal");
                    button2.setAttribute("data-target","#deleteScholarship");



                    var tr=document.createElement("tr");
                    var td1=document.createElement("td");
                    var td2=document.createElement("td");
                    var td3=document.createElement("td");
                    var td4=document.createElement("td");
                    var td5=document.createElement("td");
                    var td6=document.createElement("td");
                    var td7=document.createElement("td");

                    td1.append(input);
                    td2.append(data[i].major);
                    td3.append(data[i].classNum);
                    td4.append(data[i].account);
                    td5.append(data[i].username);
                    td6.append(data[i].scholarshipName);
                    td7.append(button,button2);
                    tr.append(td1);
                    tr.append(td2);
                    tr.append(td3);
                    tr.append(td4);
                    tr.append(td5);
                    tr.append(td6);

                    tr.append(td7);
                    i++;


                    $(".table").append(tr);}





                console.log("SUCCESS : ", data);



            },
            error: function (e) {




                console.log("Failed : ", e);

            }
        });

    }

    function fire_ajax_update2(event) {
        var showScholarshipBean=[[${showScholarshipBean}]];
        /*$("#b1").className="";
        $("#b2").className="active";*/
        console.log();
        $("#b1").attr("class","");
        $("#b2").attr("class","active");





        $.ajax({
            type: "get",
            contentType: "application/json",
            url: "/manager/scholarship/"+showScholarshipBean.subName+"/"+showScholarshipBean.grade[1],//
            dataType: 'json',
            cache: false,
            timeout: 600000,

            success: function (data) {
                let iterable = new Array(data.length);
                $(".table tbody").html("");

                var i=0;


                for (let value of iterable) {
                    var input=document.createElement("input");
                    input.setAttribute("type","checkbox");
                    input.setAttribute("name","subBox");
                    input.setAttribute("style","margin-top:7px;");



                    var button=document.createElement("button");
                    button.innerHTML = "下载";
                    button.className="btn btn-info btn-sm radius downloadScholarshipButton";
                    button.setAttribute("onclick","fire_ajax_download(event)");


                    var button2=document.createElement("button");
                    button2.innerHTML = "删除";
                    button2.className="btn btn-danger2 btn-sm interval radius";
                    button2.setAttribute("style","margin-left:30px;");
                    button2.setAttribute("onclick","fire_ajax_delete(event)");
                    button2.setAttribute("data-toggle","modal");
                    button2.setAttribute("data-target","#deleteScholarship");



                    var tr=document.createElement("tr");
                    var td1=document.createElement("td");
                    var td2=document.createElement("td");
                    var td3=document.createElement("td");
                    var td4=document.createElement("td");
                    var td5=document.createElement("td");
                    var td6=document.createElement("td");
                    var td7=document.createElement("td");

                    td1.append(input);
                    td2.append(data[i].major);
                    td3.append(data[i].classNum);
                    td4.append(data[i].account);
                    td5.append(data[i].username);
                    td6.append(data[i].scholarshipName);
                    td7.append(button,button2);
                    tr.append(td1);
                    tr.append(td2);
                    tr.append(td3);
                    tr.append(td4);
                    tr.append(td5);
                    tr.append(td6);

                    tr.append(td7);
                    i++;


                    $(".table").append(tr);}





                console.log("SUCCESS : ", data);



            },
            error: function (e) {




                console.log("Failed : ", e);

            }
        });

    }


    function fire_ajax_delete(event) {


        var account=[[${scholarshipFormBeanList}]];

        var account1=[[${showScholarshipBean}]];

        var UserAccountBean=[[${scholarshipFormBeanList}]];

        var UserAccountBeanList = new Array();





        var index=$($($($(event.target).parent())).parent()).prevAll().length;

        UserAccountBeanList.push(UserAccountBean[index].account);
        console.log(JSON.stringify(account[index].account));
        console.log(JSON.stringify(account1.subName));







        $("#deleteScholarshipButton").click(function(){
            console.log("1");
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: "/manager/scholarship/delete/"+account1.subName,//
                data: JSON.stringify(UserAccountBeanList),
                dataType: 'json',
                cache: false,
                timeout: 600000,
                success: function (data) {
                    location.reload();




                    console.log("SUCCESS : ", data);
                   /* $("#deleteScholarship").data-dismiss="modal";*/
                   $("#deleteScholarshipSuccess").style="display:block";


                },
                error: function (e) {



                    alert("删除失败")


                    console.log("Failed : ", e);

                }
            });
        });


    }
    function fire_ajax_download(event) {


        var scholarshipFormBeanList=[[${scholarshipFormBeanList}]];



        var index=$($($($(event.target).parent())).parent()).prevAll().length;

        var scholarshipFormBean=scholarshipFormBeanList[index];
        var showScholarshipBean=[[${showScholarshipBean}]];

        var indexList=new Array();



        console.log(JSON.stringify(scholarshipFormBeanList[index]));
        console.log(JSON.stringify(scholarshipFormBean));

        var ZipInfoBean=new Array();




        ZipInfoBean={account:scholarshipFormBean.account,username:scholarshipFormBean.username,scholarshipName:scholarshipFormBean.scholarshipName};
        console.log(JSON.stringify(ZipInfoBean));
        console.log(showScholarshipBean.subName);

        var ZipInfoBeanList=new Array();
        ZipInfoBeanList.push(ZipInfoBean);










            console.log("1");
            var tempform = document.createElement("form");
            tempform.action = "/manager/scholarship/zip/"+showScholarshipBean.subName+"/"+showScholarshipBean.yearScope;
            tempform.method = "post";
            tempform.style.display="none"
            tempform.target="_blank";


           /* for (var x in ZipInfoBean) {
                var opt = document.createElement("input");
                opt.name = x;
                opt.value = ZipInfoBean[x];
                tempform.appendChild(opt);
            }
*/
            var opt2=document.createElement("input");
            opt2.name="zipInfoBeanList";
            opt2.value=JSON.stringify(ZipInfoBeanList);
            console.log(JSON.stringify(ZipInfoBeanList));
            var opt = document.createElement("input");
            opt.type = "submit";
            tempform.appendChild(opt2);
            tempform.appendChild(opt);
            document.body.appendChild(tempform);
            tempform.submit();
            document.body.removeChild(tempform);
           console.log(tempform);



    }












</script>
</html>
